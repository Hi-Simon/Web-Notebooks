## 浏览器的运行机制

1.  构建DOM树。渲染引擎解析HTML文档，首先将标签转换成DOM树中的DOM节点，生成内容树（Content Tree）。
2.  构建渲染树。解析对应的CSS样式文件，构建渲染树（rendering Tree/Frame Tree）：渲染树中每个NODE都有自己的style，而且渲染树不包含隐藏的节点（比如display：none和head节点）。
3.  布局渲染树（reflow/layout）。从根节点递归调用，计算每一个元素的大小，位置等，给出每个节点所应该在屏幕上出现的精确坐标。
4.  绘制渲染树（paint/repaint）。遍历渲染树，使用UI层来绘制每个节点。

### 重绘

重绘是指一个元素外观的改变所触发的浏览器的行为，浏览器会根据元素的新属性重新绘制，使元素呈现新的外观。

**触发重绘的条件：改变元素的外观属性。如: color, background-color等**。

### 重排(重构/回流/reflow)

当渲染树中的一部分因为元素的**规模尺寸，布局，隐藏等改变而需要重新构建，这就称为回流**。

### 重绘与回流的关系

在回流时，浏览器会使渲染树中收到影响的部分失效，并重新构造这部分渲染树，完成回流后，浏览器会重新绘制收到影响的部分。所以，**回流必定引发重绘，但重绘不一定会引发重排**。

### 优化

1.  浏览器优化：浏览器会维护一个队列，把所有引起回流，重绘的操作放入这个队列，等队列的操作到了一定数量或者到了一定时间间隔，浏览器才会进行批处理，使得多次回流，重绘变成一次。
2.  减少回流和重绘就是减少对渲染树的操作，则我们可以合并多次的对DOM和样式修改，并减少对style样式的请求。
    -   直接改变元素的className。（一次性改变整个style）。
    -   先将元素设置为display:none，然后进行页面布局操作，设置完成后将元素设置为display:block。
    -   使用cloneNode(true or false)和replaceChild技术，引发一次回流和重绘。
    -   将需要多次重排的元素，position属性设为absolute或fixed，元素脱离文档流，它的变化不会影响其他元素。
    -   如果需要创建多个DOM节点，可以使用DocumentFragment创建完成后一次性加入document。